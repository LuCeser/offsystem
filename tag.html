<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="标签文章列表 - 个人博客">
    <meta name="author" content="Blog Author">
    <title>标签文章 - 编外</title>

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700;900&family=Source+Serif+Pro:ital,wght@0,400;0,600;0,700;1,400&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">

    <link rel="stylesheet" href="css/base.css">
    <link rel="stylesheet" href="css/typography.css">
    <link rel="stylesheet" href="css/layout.css">
    <link rel="stylesheet" href="css/components.css">
</head>
<body>
    <header class="site-header" role="banner">
        <div class="container">
            <nav class="main-nav" role="navigation" aria-label="主导航">
                <div class="nav-brand">
                    <a href="index.html" class="brand-link">编外</a>
                </div>
                <ul class="nav-list">
                    <li><a href="index.html" class="nav-link">首页</a></li>
                    <li class="nav-dropdown">
                        <a href="#" class="nav-link">栏目 <span class="dropdown-arrow">▼</span></a>
                        <ul class="dropdown-menu">
                            <li><a href="collection/inside.html" class="dropdown-link">编内</a></li>
                            <li><a href="collection/outside.html" class="dropdown-link">编外</a></li>
                            <li><a href="collection/weekly.html" class="dropdown-link">周刊</a></li>
                        </ul>
                    </li>
                    <li><a href="collection/inside.html" class="nav-link">全部文章</a></li>
                    <li><a href="tags.html" class="nav-link">标签</a></li>
                    <li><a href="about.html" class="nav-link">关于</a></li>
                </ul>
                <button class="nav-toggle" aria-label="切换导航菜单" aria-expanded="false">
                    <span class="hamburger"></span>
                </button>
            </nav>
        </div>
    </header>

    <main class="main-content" role="main">
        <!-- 面包屑导航 -->
        <div class="container">
            <nav class="breadcrumb" role="navigation" aria-label="面包屑导航">
                <div class="breadcrumb-item">
                    <a href="index.html" class="breadcrumb-link">首页</a>
                    <span class="breadcrumb-separator">/</span>
                </div>
                <div class="breadcrumb-item">
                    <a href="tags.html" class="breadcrumb-link">标签</a>
                    <span class="breadcrumb-separator">/</span>
                </div>
                <div class="breadcrumb-item">
                    <span class="breadcrumb-current" id="tag-name">加载中...</span>
                </div>
            </nav>
        </div>

        <!-- 标签页面头部 -->
        <section class="tag-header">
            <div class="container">
                <div class="tag-hero">
                    <div class="tag-icon">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M20.59 13.41l-7.17 7.17a2 2 0 01-2.83 0L2 12V2h10l8.59 8.59a2 2 0 010 2.82z"></path>
                            <line x1="7" y1="7" x2="7.01" y2="7"></line>
                        </svg>
                    </div>
                    <h1 class="tag-title" id="tag-title">加载中...</h1>
                    <p class="tag-description" id="tag-description">正在加载相关文章...</p>
                    <div class="tag-meta">
                        <span class="tag-count" id="tag-count">0 篇文章</span>
                        <span class="tag-updated">最后更新：<span id="tag-updated">-</span></span>
                    </div>
                </div>
            </div>
        </section>

        <!-- 标签统计 -->
        <section class="tag-stats">
            <div class="container">
                <div class="stats-grid">
                    <div class="stat-item">
                        <div class="stat-number" id="article-count">0</div>
                        <div class="stat-label">相关文章</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="collection-count">0</div>
                        <div class="stat-label">相关栏目</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-number" id="total-time">0分钟</div>
                        <div class="stat-label">总阅读时间</div>
                    </div>
                </div>
            </div>
        </section>

        <!-- 相关标签 -->
        <section class="related-tags" id="related-tags-section">
            <div class="container">
                <header class="section-header">
                    <h3 class="section-title">相关标签</h3>
                </header>
                <div class="related-tags-list" id="related-tags">
                    <!-- 动态生成相关标签 -->
                </div>
            </div>
        </section>

        <!-- 文章列表 -->
        <section class="tag-articles">
            <div class="container">
                <header class="section-header">
                    <h3 class="section-title">相关文章</h3>
                </header>
                <div class="posts-grid" id="articles-grid">
                    <!-- 动态生成文章列表 -->
                </div>

                <!-- 空状态 -->
                <div class="empty-state" id="empty-state" style="display: none;">
                    <div class="empty-icon">
                        <svg width="64" height="64" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <path d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                        </svg>
                    </div>
                    <h3 class="empty-title">暂无相关文章</h3>
                    <p class="empty-description">该标签下暂时没有文章，请尝试查看其他标签。</p>
                    <a href="tags.html" class="cta-button">浏览所有标签</a>
                </div>
            </div>
        </section>
    </main>

    <footer class="site-footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <p class="copyright">&copy; 2024 编外. 保留所有权利。</p>
                <div class="footer-links">
                    <a href="#" class="footer-link" aria-label="RSS订阅">RSS</a>
                    <a href="#" class="footer-link" aria-label="GitHub">GitHub</a>
                    <a href="#" class="footer-link" aria-label="Twitter">Twitter</a>
                </div>
            </div>
        </div>
    </footer>

    <script>
        // 阅读时间计算函数（基于400字/分钟的平均阅读速度）
        function calculateReadingTime(chineseChars, englishWords) {
            const totalWords = chineseChars + englishWords;
            const readingSpeed = 400; // 中文平均阅读速度：400字/分钟
            const minutes = Math.ceil(totalWords / readingSpeed);
            return minutes;
        }

        // 文章数据（基于实际字数计算）
        const articles = [
            {
                title: "ChatGPT作为方法",
                url: "articles/chatgpt-as-method.html",
                date: "2023年8月4日",
                category: "编外",
                tags: ["ChatGPT", "AI工具", "学习方法", "效率提升", "费曼学习法"],
                excerpt: "自今年年初ChatGPT引爆社交网络以来，我们第一次体验到了科幻作品中那种无所不能的人工智能...",
                chineseChars: 1972,
                englishWords: 15,
                readingTime: calculateReadingTime(1972, 15)
            },
            {
                title: "御敌于外：配置HSTS防御中间人攻击",
                url: "articles/mitm.html",
                date: "2020年7月30日",
                category: "编内",
                tags: ["网络安全", "HTTPS", "中间人攻击", "HSTS", "Nginx"],
                excerpt: "之前在自己的服务器上架设了博客并发布到了公网，考虑到安全性还特意加了HTTPS支持...",
                chineseChars: 1626,
                englishWords: 648,
                readingTime: calculateReadingTime(1626, 648)
            },
            {
                title: "重听罗振宇",
                url: "articles/weekly-journal-vol44.html",
                date: "2025年11月2日",
                category: "周刊",
                tags: ["播客", "罗振宇", "长期主义", "媒体观察", "AI就业"],
                excerpt: "上周听了播客对话罗振宇，这是我第一次听罗振宇与他人对谈。在他的节目之外听他讲自己的方法和想法...",
                chineseChars: 846,
                englishWords: 1,
                readingTime: calculateReadingTime(846, 1)
            },
            {
                title: "博客系统新范式",
                url: "articles/weekly-journal-vol45.html",
                date: "2025年11月9日",
                category: "周刊",
                tags: ["AI写作", "Claude Code", "博客系统", "文明之旅", "生成式AI"],
                excerpt: "这周，我在使用Claude Code写作时，突然意识到：博客系统的逻辑，正在被彻底改写...",
                chineseChars: 1308,
                englishWords: 22,
                readingTime: calculateReadingTime(1308, 22)
            }
        ];

        // 获取URL参数中的标签名
        function getTagFromUrl() {
            const urlParams = new URLSearchParams(window.location.search);
            return urlParams.get('tag');
        }

        // 解析URL编码的标签名
        function decodeTagName(tag) {
            return decodeURIComponent(tag || '');
        }

        // 根据标签筛选文章
        function filterArticlesByTag(tag) {
            if (!tag) return [];
            return articles.filter(article =>
                article.tags.some(articleTag =>
                    articleTag.toLowerCase() === tag.toLowerCase()
                )
            );
        }

        // 获取相关标签（出现在同一文章中的其他标签）
        function getRelatedTags(targetTag, filteredArticles) {
            const relatedTags = new Set();

            filteredArticles.forEach(article => {
                article.tags.forEach(tag => {
                    if (tag.toLowerCase() !== targetTag.toLowerCase()) {
                        relatedTags.add(tag);
                    }
                });
            });

            return Array.from(relatedTags).slice(0, 8); // 最多显示8个相关标签
        }

        // 获取涉及到的栏目
        function getCollections(filteredArticles) {
            const collections = new Set();
            filteredArticles.forEach(article => {
                collections.add(article.category);
            });
            return Array.from(collections);
        }

        // 计算总阅读时间
        function getTotalReadingTime(filteredArticles) {
            return filteredArticles.reduce((total, article) => total + article.readingTime, 0);
        }

        // 格式化阅读时间
        function formatReadingTime(minutes) {
            if (minutes >= 60) {
                return `${Math.floor(minutes / 60)}小时${minutes % 60}分钟`;
            }
            return `${minutes}分钟`;
        }

        // 生成文章卡片HTML
        function generateArticleCard(article) {
            const tagsHtml = article.tags.map(tag =>
                `<span class="tag">${tag}</span>`
            ).join('');

            return `
                <article class="post-card">
                    <div class="post-content">
                        <div class="post-meta">
                            <time datetime="${article.date}" class="post-date">${article.date}</time>
                            <span class="post-category">${article.category}</span>
                        </div>
                        <h3 class="post-title">
                            <a href="${article.url}">${article.title}</a>
                        </h3>
                        <p class="post-excerpt">${article.excerpt}</p>
                        <div class="post-tags">
                            ${tagsHtml}
                        </div>
                        <div class="post-author">
                            <span class="author-name">作者</span>
                            <span class="reading-time">阅读时间 ${article.readingTime} 分钟</span>
                        </div>
                    </div>
                </article>
            `;
        }

        // 更新页面内容
        function updatePage() {
            const tag = getTagFromUrl();
            const decodedTag = decodeTagName(tag);

            if (!tag) {
                // 如果没有标签参数，显示标签页
                document.getElementById('tag-name').textContent = '未指定标签';
                document.getElementById('tag-title').textContent = '未指定标签';
                document.getElementById('tag-description').textContent = '请从标签页面选择一个标签';
                document.getElementById('empty-state').style.display = 'block';
                document.getElementById('articles-grid').style.display = 'none';
                document.getElementById('related-tags-section').style.display = 'none';
                document.querySelector('.tag-stats').style.display = 'none';
                return;
            }

            const filteredArticles = filterArticlesByTag(tag);
            const collections = getCollections(filteredArticles);
            const totalTime = getTotalReadingTime(filteredArticles);
            const relatedTags = getRelatedTags(tag, filteredArticles);

            // 更新标签信息
            document.getElementById('tag-name').textContent = decodedTag;
            document.getElementById('tag-title').textContent = decodedTag;
            document.getElementById('tag-count').textContent = `${filteredArticles.length} 篇文章`;

            // 更新描述
            if (filteredArticles.length > 0) {
                document.getElementById('tag-description').textContent = `关于"${decodedTag}"标签的${filteredArticles.length}篇文章`;
                const latestDate = filteredArticles[filteredArticles.length - 1].date;
                document.getElementById('tag-updated').textContent = latestDate;
            } else {
                document.getElementById('tag-description').textContent = `暂无关于"${decodedTag}"标签的文章`;
            }

            // 更新统计信息
            document.getElementById('article-count').textContent = filteredArticles.length;
            document.getElementById('collection-count').textContent = collections.length;
            document.getElementById('total-time').textContent = formatReadingTime(totalTime);

            // 生成相关标签
            if (relatedTags.length > 0) {
                const relatedTagsHtml = relatedTags.map(relatedTag =>
                    `<a href="tag.html?tag=${encodeURIComponent(relatedTag)}" class="tag related-tag">${relatedTag}</a>`
                ).join('');
                document.getElementById('related-tags').innerHTML = relatedTagsHtml;
            } else {
                document.getElementById('related-tags-section').style.display = 'none';
            }

            // 生成文章列表
            if (filteredArticles.length > 0) {
                const articlesHtml = filteredArticles.map(article => generateArticleCard(article)).join('');
                document.getElementById('articles-grid').innerHTML = articlesHtml;
                document.getElementById('articles-grid').style.display = 'grid';
                document.getElementById('empty-state').style.display = 'none';
            } else {
                document.getElementById('articles-grid').style.display = 'none';
                document.getElementById('empty-state').style.display = 'block';
            }
        }

        // 页面加载完成后执行
        document.addEventListener('DOMContentLoaded', updatePage);
    </script>
</body>
</html>